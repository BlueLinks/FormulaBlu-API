name: Test Secrets Configuration

on:
    workflow_dispatch:
    push:
        branches: [main]
        paths:
            - ".github/workflows/test-secrets.yml"
            - ".github/scripts/validate-secrets.sh"

jobs:
    test-secrets:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Make validation script executable
              run: chmod +x .github/scripts/validate-secrets.sh

            - name: Validate secrets configuration
              run: .github/scripts/validate-secrets.sh
              env:
                  DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
                  DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
                  DOCKER_REGISTRY: ${{ secrets.DOCKER_REGISTRY }}
                  DOCKER_NAMESPACE: ${{ secrets.DOCKER_NAMESPACE }}

            - name: Test Docker Hub connectivity
              if: secrets.DOCKERHUB_USERNAME != '' && secrets.DOCKERHUB_TOKEN != ''
              run: |
                  echo "Testing Docker Hub connectivity..."
                  echo "${{ secrets.DOCKERHUB_TOKEN }}" | docker login --username "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin
                  echo "✅ Docker Hub login successful"
                  docker logout

            - name: Summary
              run: |
                  echo "## 🔐 Secrets Configuration Test Results" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "### ✅ Test Completed Successfully!" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "All required secrets are properly configured and working." >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "### Next Steps:" >> $GITHUB_STEP_SUMMARY
                  echo "- Your CI/CD workflows should now run without secret-related errors" >> $GITHUB_STEP_SUMMARY
                  echo "- You can safely trigger build workflows" >> $GITHUB_STEP_SUMMARY
                  echo "- Monitor workflow logs for any other issues" >> $GITHUB_STEP_SUMMARY
